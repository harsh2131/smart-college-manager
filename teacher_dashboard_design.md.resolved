# Teacher Dashboard Module Design
## Smart College Resource & Deadline Manager

---

## 1ï¸âƒ£ Teacher Authentication & Authorization Flow

### JWT-Based Authentication Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      AUTHENTICATION FLOW                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 1: Teacher Login
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Angular Login   â”‚â”€â”€â”€â”€â–¶â”‚  POST /auth/login â”‚â”€â”€â”€â”€â–¶â”‚  Validate creds  â”‚
â”‚  Form            â”‚     â”‚  {email, password}â”‚     â”‚  in MongoDB      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                           â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  Generate JWT Token                         â”‚
                         â”‚  Payload: { userId, email, role: 'teacher' }â”‚
                         â”‚  Expiry: 24 hours                           â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                           â”‚
                                                           â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Store in        â”‚â—€â”€â”€â”€â”€â”‚  Response: { token, user: {...}, expiresIn } â”‚
â”‚  localStorage    â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

STEP 2: Authenticated Requests
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Angular HTTP    â”‚â”€â”€â”€â”€â–¶â”‚  Headers: { Authorization: 'Bearer <TOKEN>' }â”‚
â”‚  Interceptor     â”‚     â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### JWT Token Structure

```javascript
// Token Payload
{
  "userId": "TCH_001",
  "email": "sharma@college.edu",
  "role": "teacher",
  "department": "CSE",
  "iat": 1703500000,      // Issued at
  "exp": 1703586400       // Expires in 24h
}
```

### Role-Based Authorization Middleware

```javascript
// Backend middleware chain for teacher routes
router.use('/teacher/*', [
  authMiddleware,           // Verify JWT is valid
  roleMiddleware('teacher') // Check role === 'teacher'
]);

// authMiddleware.js
function authMiddleware(req, res, next) {
  const token = req.headers.authorization?.split(' ')[1];
  if (!token) return res.status(401).json({ error: 'No token provided' });
  
  try {
    const decoded = jwt.verify(token, process.env.JWT_SECRET);
    req.user = decoded;  // Attach user to request
    next();
  } catch (err) {
    return res.status(401).json({ error: 'Invalid token' });
  }
}

// roleMiddleware.js
function roleMiddleware(...allowedRoles) {
  return (req, res, next) => {
    if (!allowedRoles.includes(req.user.role)) {
      return res.status(403).json({ error: 'Access denied' });
    }
    next();
  };
}
```

### Angular Auth Guard

```typescript
// teacher.guard.ts
@Injectable({ providedIn: 'root' })
export class TeacherGuard implements CanActivate {
  constructor(private authService: AuthService, private router: Router) {}

  canActivate(): boolean {
    const user = this.authService.getCurrentUser();
    if (user && user.role === 'teacher') {
      return true;
    }
    this.router.navigate(['/login']);
    return false;
  }
}
```

---

## 2ï¸âƒ£ Teacher Dashboard Features

### Feature Overview

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘©â€ğŸ« TEACHER DASHBOARD                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  ğŸ“š Manage  â”‚ â”‚  ğŸ‘¥ Assign  â”‚ â”‚  ğŸ“‹ Mark    â”‚ â”‚  ğŸ“ Enter   â”‚        â”‚
â”‚  â”‚  Subjects   â”‚ â”‚  Students   â”‚ â”‚  Attendance â”‚ â”‚  Marks      â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  â° Create  â”‚ â”‚  ğŸ“¤ Upload  â”‚ â”‚  ğŸ“Š View    â”‚ â”‚  ğŸš¨ At-Risk â”‚        â”‚
â”‚  â”‚  Deadlines  â”‚ â”‚  Resources  â”‚ â”‚  Analytics  â”‚ â”‚  Students   â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Feature A: Subject Management (CRUD)

#### Create Subject
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â• CREATE SUBJECT                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Subject Code*:    [CS301           ]                       â”‚
â”‚  Subject Name*:    [Database Management Systems]            â”‚
â”‚  Department*:      [CSE             â–¼]                      â”‚
â”‚  Semester*:        [5               â–¼]                      â”‚
â”‚  Credits:          [4               ]                       â”‚
â”‚                                                             â”‚
â”‚  â”€â”€â”€ ATTENDANCE SETTINGS â”€â”€â”€                                â”‚
â”‚  Total Planned Lectures:  [60      ]                        â”‚
â”‚  Minimum Attendance %*:   [75      ]  (for eligibility)     â”‚
â”‚                                                             â”‚
â”‚  â”€â”€â”€ MARKS SETTINGS â”€â”€â”€                                     â”‚
â”‚  Internal Max Marks:      [30      ]                        â”‚
â”‚  Practical Max Marks:     [20      ]                        â”‚
â”‚  External Max Marks:      [50      ]                        â”‚
â”‚                                                             â”‚
â”‚  Divisions to Apply:  [â˜‘ A] [â˜‘ B] [â˜ C]                     â”‚
â”‚                                                             â”‚
â”‚  [Cancel]                              [Create Subject â†’]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Update Subject
- Teacher can modify: subject name, min attendance %, marks distribution
- Cannot modify: subject code (primary identifier)

#### Delete Subject
- Soft delete (mark as inactive) rather than hard delete
- Preserves historical attendance and marks data

---

### Feature B: Assign Students to Subjects

#### Assignment Interface
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ‘¥ ASSIGN STUDENTS TO SUBJECT                                          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Subject: [DBMS - CS301, Sem 5  â–¼]                                      â”‚
â”‚                                                                         â”‚
â”‚  Filter Students By:                                                    â”‚
â”‚  Division: [( ) A  (â€¢) B  ( ) C  ( ) All]                               â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚  â˜‘ Select All (48 students)                                      â”‚   â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚   â”‚
â”‚  â”‚  [â˜‘] CS5B001  Rahul Patel                                        â”‚   â”‚
â”‚  â”‚  [â˜‘] CS5B002  Priya Shah                                         â”‚   â”‚
â”‚  â”‚  [â˜‘] CS5B003  Amit Kumar                                         â”‚   â”‚
â”‚  â”‚  [â˜] CS5B004  Sneha Desai  (Already enrolled in another batch)   â”‚   â”‚
â”‚  â”‚  ...                                                             â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  Selected: 47 students                                                  â”‚
â”‚  [Cancel]                                      [Assign Students â†’]      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Auto-Assignment Option
- When creating subject, auto-enroll all students of selected semester/division

---

### Feature C: Attendance Upload (Daily/Lecture-wise)

#### Attendance Marking Interface
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“‹ MARK ATTENDANCE                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Subject:  [DBMS - CS301      â–¼]                                        â”‚
â”‚  Date:     [Dec 25, 2024      ğŸ“…]                                       â”‚
â”‚  Lecture:  [Lecture 49 of 60   ]  (auto-incremented)                    â”‚
â”‚  Topic:    [Normalization - BCNF (optional)]                            â”‚
â”‚                                                                         â”‚
â”‚  â”€â”€â”€ QUICK ACTIONS â”€â”€â”€                                                  â”‚
â”‚  [âœ“ Mark All Present]  [âœ— Mark All Absent]  [â†» Reset]                   â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Roll No   â”‚ Name            â”‚ Status     â”‚ Current % â”‚ Flag   â”‚     â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚     â”‚
â”‚  â”‚  CS5B001   â”‚ Rahul Patel     â”‚ [P] [A]    â”‚  68% ğŸ”´   â”‚ âš ï¸     â”‚     â”‚
â”‚  â”‚  CS5B002   â”‚ Priya Shah      â”‚ [P] [A]    â”‚  85% ğŸŸ¢   â”‚        â”‚     â”‚
â”‚  â”‚  CS5B003   â”‚ Amit Kumar      â”‚ [P] [A]    â”‚  72% ğŸŸ¡   â”‚        â”‚     â”‚
â”‚  â”‚  CS5B004   â”‚ Sneha Desai     â”‚ [P] [A]    â”‚  90% ğŸŸ¢   â”‚        â”‚     â”‚
â”‚  â”‚  ...       â”‚                 â”‚            â”‚           â”‚        â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                         â”‚
â”‚  Summary: 45 Present | 3 Absent | 48 Total                              â”‚
â”‚                                                                         â”‚
â”‚  [Cancel]                                          [Submit Attendance]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Attendance Update/Edit
- Teacher can edit past attendance within 7-day window
- Audit log maintained for all changes

---

### Feature D: Marks Upload (Internal, Practical, External)

#### Marks Entry Interface
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ğŸ“ ENTER MARKS                                                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Subject:    [DBMS - CS301      â–¼]                                      â”‚
â”‚  Test Type:  [( ) Internal  ( ) Practical  ( ) External]                â”‚
â”‚                                                                         â”‚
â”‚  â”€â”€â”€ TEST DETAILS â”€â”€â”€                                                   â”‚
â”‚  Test Name:  [Unit Test 1            ]                                  â”‚
â”‚  Max Marks:  [20                     ]                                  â”‚
â”‚  Date:       [Dec 15, 2024           ]                                  â”‚
â”‚                                                                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”     â”‚
â”‚  â”‚  Roll No   â”‚ Name            â”‚ Marks (out of 20) â”‚ Status      â”‚     â”‚
â”‚  â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€  â”‚     â”‚
â”‚  â”‚  CS5B001   â”‚ Rahul Patel     â”‚ [14           ]   â”‚ âœ“ Valid     â”‚     â”‚
â”‚  â”‚  CS5B002   â”‚ Priya Shah      â”‚ [18           ]   â”‚ âœ“ Valid     â”‚     â”‚
â”‚  â”‚  CS5B003   â”‚ Amit Kumar      â”‚ [25           ]   â”‚ âœ— Exceeds!  â”‚     â”‚
â”‚  â”‚  CS5B004   â”‚ Sneha Desai     â”‚ [AB           ]   â”‚ Absent      â”‚     â”‚
â”‚  â”‚  ...       â”‚                 â”‚                   â”‚             â”‚     â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜     â”‚
â”‚                                                                         â”‚
â”‚  [Import from CSV]  [Download Template]                                 â”‚
â”‚                                                                         â”‚
â”‚  [Cancel]                                              [Submit Marks]   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### Marks Categories
| Category | Components | Typical Weight |
|----------|-----------|---------------|
| **Internal** | Assignments, Quizzes, Unit Tests | 30 marks |
| **Practical** | Lab work, Experiments, Viva | 20 marks |
| **External** | Final Exam (university) | 50 marks |

---

### Feature E: Minimum Attendance Setting

#### Per-Subject Configuration
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  âš™ï¸ ATTENDANCE ELIGIBILITY SETTINGS - DBMS (CS301)         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                             â”‚
â”‚  Minimum Required Attendance: [75    ]%                     â”‚
â”‚                                                             â”‚
â”‚  Eligibility Thresholds:                                    â”‚
â”‚  â”œâ”€â”€ â‰¥ 75%  â†’  âœ… Allowed for exam                          â”‚
â”‚  â”œâ”€â”€ 65-74% â†’  âš ï¸ Condonation eligible (with penalty)       â”‚
â”‚  â””â”€â”€ < 65%  â†’  âŒ Detained / Not allowed                    â”‚
â”‚                                                             â”‚
â”‚  Auto-Warning Settings:                                     â”‚
â”‚  [â˜‘] Send warning when student drops below 80%              â”‚
â”‚  [â˜‘] Send critical alert when student drops below 75%       â”‚
â”‚  [â˜‘] Notify HOD for detained students                       â”‚
â”‚                                                             â”‚
â”‚  [Save Settings]                                            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### Feature F: Deadline Management

#### Create Deadline Interface
```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  â° CREATE DEADLINE                                                     â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚  Subject:      [DBMS - CS301              â–¼]                            â”‚
â”‚  Title*:       [Assignment 3 - ER Diagram   ]                           â”‚
â”‚                                                                         â”‚
â”‚  Type:  ( ) Assignment  ( ) Exam  ( ) Project  ( ) Quiz  ( ) Other      â”‚
â”‚                                                                         â”‚
â”‚  Due Date*:    [Dec 30, 2024    ğŸ“…]                                     â”‚
â”‚  Due Time*:    [11:59 PM        ğŸ•]                                     â”‚
â”‚                                                                         â”‚
â”‚  Description:                                                           â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Design an ER diagram for a library management system.            â”‚   â”‚
â”‚  â”‚ Include entities: Book, Member, Loan, Author, Category.          â”‚   â”‚
â”‚  â”‚ Show all relationships with cardinality.                         â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚                                                                         â”‚
â”‚  Attachments:  [ğŸ“ Upload Files]  problem_statement.pdf (1.2 MB)        â”‚
â”‚                                                                         â”‚
â”‚  Marks Weightage:  [10     ] marks (out of internal)                    â”‚
â”‚                                                                         â”‚
â”‚  Applies To:                                                            â”‚
â”‚  Semester: [5]   Division: [(â€¢) A  ( ) B  ( ) All]                      â”‚
â”‚                                                                         â”‚
â”‚  Reminder Settings:                                                     â”‚
â”‚  [â˜‘] 7 days before  [â˜‘] 3 days before  [â˜‘] 1 day before  [â˜‘] Due day    â”‚
â”‚                                                                         â”‚
â”‚  [Cancel]                                          [Create Deadline â†’]  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 3ï¸âƒ£ Attendance Calculation Logic

### Core Calculation Formula

```javascript
// AttendanceService.js

class AttendanceService {
  
  /**
   * Calculate attendance for a student in a subject
   */
  async calculateAttendance(studentId, subjectId) {
    // Get subject details
    const subject = await Subject.findById(subjectId);
    const minRequired = subject.minAttendancePercent; // e.g., 75
    
    // Count attendance records
    const totalLectures = await Attendance.countDocuments({ 
      subjectId, 
      studentId 
    });
    
    const presentCount = await Attendance.countDocuments({ 
      subjectId, 
      studentId, 
      status: 'present' 
    });
    
    // Calculate percentage
    const percentage = totalLectures > 0 
      ? Math.round((presentCount / totalLectures) * 100 * 10) / 10  // 1 decimal
      : 100;
    
    // Determine eligibility status
    const eligibility = this.determineEligibility(percentage, minRequired);
    
    // Calculate how many more can be missed / need to attend
    const projection = this.calculateProjection(presentCount, totalLectures, minRequired);
    
    return {
      studentId,
      subjectId,
      totalLectures,
      presentCount,
      absentCount: totalLectures - presentCount,
      percentage,
      eligibility,
      projection
    };
  }
  
  /**
   * Determine student eligibility for exam
   */
  determineEligibility(percentage, minRequired) {
    if (percentage >= minRequired) {
      return {
        status: 'ALLOWED',
        label: 'âœ… Eligible for Exam',
        color: 'green'
      };
    } else if (percentage >= minRequired - 10) {  // Within condonation range
      return {
        status: 'CONDONATION',
        label: 'âš ï¸ Condonation Required',
        color: 'yellow'
      };
    } else {
      return {
        status: 'DETAINED',
        label: 'âŒ Not Allowed for Exam',
        color: 'red'
      };
    }
  }
  
  /**
   * Project future attendance scenarios
   */
  calculateProjection(present, total, minRequired) {
    // How many lectures can still be missed?
    // Formula: present - (minRequired% Ã— total) must stay >= 0
    // Solving: canMiss = present - (minRequired/100 Ã— total)
    
    const requiredPresent = Math.ceil((minRequired / 100) * total);
    const surplus = present - requiredPresent;
    
    // If student is short, calculate lectures needed to recover
    if (surplus < 0) {
      // Need to attend X more consecutive lectures to reach minRequired
      // (present + X) / (total + X) >= minRequired/100
      // Solving for X: X = (minRequired Ã— total - 100 Ã— present) / (100 - minRequired)
      
      const lecturesNeeded = Math.ceil(
        (minRequired * total - 100 * present) / (100 - minRequired)
      );
      
      return {
        canMiss: 0,
        needToAttend: lecturesNeeded,
        message: `Must attend next ${lecturesNeeded} lectures consecutively`
      };
    }
    
    return {
      canMiss: surplus,
      needToAttend: 0,
      message: surplus > 0 
        ? `Can safely miss ${surplus} more lecture(s)` 
        : 'At exact minimum, cannot miss any more'
    };
  }
}
```

### Calculation Examples

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  EXAMPLE CALCULATIONS                                                  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                                        â”‚
â”‚  Student A: DBMS                                                       â”‚
â”‚  â”œâ”€â”€ Total Lectures: 50                                                â”‚
â”‚  â”œâ”€â”€ Present: 40                                                       â”‚
â”‚  â”œâ”€â”€ Percentage: (40/50) Ã— 100 = 80%                                   â”‚
â”‚  â”œâ”€â”€ Status: âœ… ALLOWED (80% â‰¥ 75%)                                    â”‚
â”‚  â””â”€â”€ Can Miss: 40 - ceil(0.75 Ã— 50) = 40 - 38 = 2 more lectures        â”‚
â”‚                                                                        â”‚
â”‚  Student B: DBMS                                                       â”‚
â”‚  â”œâ”€â”€ Total Lectures: 50                                                â”‚
â”‚  â”œâ”€â”€ Present: 35                                                       â”‚
â”‚  â”œâ”€â”€ Percentage: (35/50) Ã— 100 = 70%                                   â”‚
â”‚  â”œâ”€â”€ Status: âš ï¸ CONDONATION (70% < 75% but â‰¥ 65%)                      â”‚
â”‚  â””â”€â”€ Needs: Must attend next 10 consecutive to reach 75%               â”‚
â”‚            (35+10)/(50+10) = 45/60 = 75% âœ“                             â”‚
â”‚                                                                        â”‚
â”‚  Student C: DBMS                                                       â”‚
â”‚  â”œâ”€â”€ Total Lectures: 50                                                â”‚
â”‚  â”œâ”€â”€ Present: 30                                                       â”‚
â”‚  â”œâ”€â”€ Percentage: (30/50) Ã— 100 = 60%                                   â”‚
â”‚  â”œâ”€â”€ Status: âŒ DETAINED (60% < 65%)                                   â”‚
â”‚  â””â”€â”€ Recovery: Mathematically impossible to reach 75%                  â”‚
â”‚                                                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Eligibility Status Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     ELIGIBILITY DETERMINATION                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                    Calculate Attendance %
                           â”‚
                           â–¼
              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
              â”‚  percentage >= 75%?    â”‚
              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚           â”‚
                   YES          NO
                    â”‚           â”‚
                    â–¼           â–¼
             â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
             â”‚ ALLOWED  â”‚   â”‚   percentage >= 65%?   â”‚
             â”‚    âœ…    â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
             â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚           â”‚
                                 YES          NO
                                  â”‚           â”‚
                                  â–¼           â–¼
                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚ CONDONATIONâ”‚  â”‚ DETAINED â”‚
                         â”‚     âš ï¸     â”‚  â”‚    âŒ    â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## 4ï¸âƒ£ Backend APIs Required

### Authentication APIs

| Method | Route | Description | Auth |
|--------|-------|-------------|------|
| POST | `/api/auth/register` | Register teacher account | Admin only |
| POST | `/api/auth/login` | Login, receive JWT | Public |
| POST | `/api/auth/logout` | Invalidate token | Authenticated |
| GET | `/api/auth/me` | Get current user | Authenticated |
| PUT | `/api/auth/password` | Change password | Authenticated |

### Subject APIs

| Method | Route | Description | Auth |
|--------|-------|-------------|------|
| POST | `/api/subjects` | Create new subject | Teacher |
| GET | `/api/subjects` | List all subjects | Authenticated |
| GET | `/api/subjects/my` | List teacher's subjects | Teacher |
| GET | `/api/subjects/:id` | Get subject details | Authenticated |
| PUT | `/api/subjects/:id` | Update subject | Teacher (owner) |
| DELETE | `/api/subjects/:id` | Soft delete subject | Teacher (owner) |
| PUT | `/api/subjects/:id/settings` | Update attendance settings | Teacher |

### Student Assignment APIs

| Method | Route | Description | Auth |
|--------|-------|-------------|------|
| GET | `/api/subjects/:id/students` | List students in subject | Teacher |
| POST | `/api/subjects/:id/students` | Assign students to subject | Teacher |
| DELETE | `/api/subjects/:id/students/:studentId` | Remove student | Teacher |
| POST | `/api/subjects/:id/students/bulk` | Bulk assign students | Teacher |

### Attendance APIs

| Method | Route | Description | Auth |
|--------|-------|-------------|------|
| POST | `/api/attendance/mark` | Mark attendance (batch) | Teacher |
| GET | `/api/attendance/subject/:subjectId/date/:date` | Get day's attendance | Teacher |
| GET | `/api/attendance/subject/:subjectId/summary` | Class attendance summary | Teacher |
| GET | `/api/attendance/student/:studentId` | Student's all attendance | Student (own) / Teacher |
| GET | `/api/attendance/student/:studentId/subject/:subjectId` | Detailed breakdown | Auth |
| PUT | `/api/attendance/:id` | Update attendance record | Teacher |
| GET | `/api/attendance/at-risk/:subjectId` | Students below threshold | Teacher |

### Marks APIs

| Method | Route | Description | Auth |
|--------|-------|-------------|------|
| POST | `/api/marks` | Enter marks (batch) | Teacher |
| GET | `/api/marks/subject/:subjectId/test/:testName` | Get test marks | Teacher |
| GET | `/api/marks/student/:studentId` | Student's all marks | Student (own) / Teacher |
| GET | `/api/marks/student/:studentId/subject/:subjectId` | Subject-wise marks | Auth |
| PUT | `/api/marks/:id` | Update marks entry | Teacher |
| DELETE | `/api/marks/:id` | Delete marks entry | Teacher |
| GET | `/api/marks/summary/:studentId` | Internal marks summary | Auth |

### Deadline APIs

| Method | Route | Description | Auth |
|--------|-------|-------------|------|
| POST | `/api/deadlines` | Create deadline | Teacher |
| GET | `/api/deadlines` | List deadlines (with filters) | Authenticated |
| GET | `/api/deadlines/my` | Teacher's created deadlines | Teacher |
| GET | `/api/deadlines/:id` | Get deadline details | Authenticated |
| PUT | `/api/deadlines/:id` | Update deadline | Teacher (owner) |
| DELETE | `/api/deadlines/:id` | Delete deadline | Teacher (owner) |

### Analytics APIs

| Method | Route | Description | Auth |
|--------|-------|-------------|------|
| GET | `/api/analytics/class/:subjectId` | Class-wide statistics | Teacher |
| GET | `/api/analytics/student/:studentId` | Student dashboard data | Student (own) / Teacher |
| GET | `/api/analytics/at-risk` | All at-risk students | Teacher |
| GET | `/api/analytics/eligibility/:subjectId` | Eligibility report | Teacher |

---

## 5ï¸âƒ£ MongoDB Schema Design

### Teacher Schema (embedded in User)

```javascript
// models/User.js
const userSchema = new mongoose.Schema({
  userId: { 
    type: String, 
    required: true, 
    unique: true 
  },  // TCH_001, STU_001
  
  name: { 
    type: String, 
    required: true 
  },
  
  email: { 
    type: String, 
    required: true, 
    unique: true,
    lowercase: true,
    match: [/^\S+@\S+\.\S+$/, 'Invalid email']
  },
  
  passwordHash: { 
    type: String, 
    required: true 
  },
  
  role: { 
    type: String, 
    enum: ['student', 'teacher', 'admin'],
    required: true 
  },
  
  department: { 
    type: String, 
    required: true 
  },
  
  // Teacher-specific fields
  designation: { 
    type: String,
    enum: ['Assistant Professor', 'Associate Professor', 'Professor', 'HOD']
  },
  
  subjectsTeaching: [{
    type: mongoose.Schema.Types.ObjectId,
    ref: 'Subject'
  }],
  
  // Student-specific fields
  semester: { type: Number, min: 1, max: 8 },
  division: String,
  rollNumber: String,
  enrolledSubjects: [{
    type: mongoose.Schema.Types.ObjectId,
    ref: 'Subject'
  }],
  
  isActive: { type: Boolean, default: true },
  createdAt: { type: Date, default: Date.now },
  updatedAt: { type: Date, default: Date.now }
});

// Compound indexes
userSchema.index({ role: 1, department: 1 });
userSchema.index({ role: 1, semester: 1, division: 1 });
```

### Subject Schema

```javascript
// models/Subject.js
const subjectSchema = new mongoose.Schema({
  subjectCode: { 
    type: String, 
    required: true, 
    unique: true,
    uppercase: true
  },  // CS301
  
  subjectName: { 
    type: String, 
    required: true 
  },
  
  department: { 
    type: String, 
    required: true 
  },
  
  semester: { 
    type: Number, 
    required: true,
    min: 1,
    max: 8
  },
  
  divisions: [{
    type: String,
    enum: ['A', 'B', 'C', 'D']
  }],
  
  credits: { 
    type: Number, 
    default: 4 
  },
  
  // Attendance configuration
  totalPlannedLectures: { 
    type: Number, 
    default: 60 
  },
  
  lecturesConducted: { 
    type: Number, 
    default: 0 
  },
  
  minAttendancePercent: { 
    type: Number, 
    default: 75,
    min: 0,
    max: 100
  },
  
  // Marks configuration
  marksDistribution: {
    internal: { type: Number, default: 30 },
    practical: { type: Number, default: 20 },
    external: { type: Number, default: 50 }
  },
  
  // Ownership
  createdBy: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User',
    required: true
  },
  
  teachers: [{
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User'
  }],
  
  enrolledStudents: [{
    type: mongoose.Schema.Types.ObjectId,
    ref: 'User'
  }],
  
  isActive: { type: Boolean, default: true },
  createdAt: { type: Date, default: Date.now },
  updatedAt: { type: Date, default: Date.now }
});

// Indexes
subjectSchema.index({ department: 1, semester: 1 });
subjectSchema.index({ createdBy: 1 });
```

### Attendance Schema

```javascript
// models/Attendance.js
const attendanceSchema = new mongoose.Schema({
  studentId: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User',
    required: true
  },
  
  subjectId: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'Subject',
    required: true
  },
  
  date: { 
    type: Date, 
    required: true 
  },
  
  lectureNumber: { 
    type: Number, 
    required: true,
    min: 1
  },
  
  status: { 
    type: String, 
    enum: ['present', 'absent', 'late', 'excused'],
    required: true
  },
  
  topic: String,  // Optional: Topic covered in this lecture
  
  markedBy: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User',
    required: true
  },
  
  markedAt: { 
    type: Date, 
    default: Date.now 
  },
  
  // For audit trail on edits
  lastEditedBy: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User'
  },
  lastEditedAt: Date,
  editReason: String
});

// CRITICAL: Prevent duplicate attendance entries
attendanceSchema.index(
  { studentId: 1, subjectId: 1, date: 1, lectureNumber: 1 }, 
  { unique: true }
);

// Query optimization indexes
attendanceSchema.index({ subjectId: 1, date: 1 });
attendanceSchema.index({ studentId: 1, subjectId: 1 });
```

### Marks Schema

```javascript
// models/Marks.js
const marksSchema = new mongoose.Schema({
  studentId: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User',
    required: true
  },
  
  subjectId: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'Subject',
    required: true
  },
  
  category: { 
    type: String, 
    enum: ['internal', 'practical', 'external'],
    required: true
  },
  
  testType: { 
    type: String, 
    enum: ['assignment', 'quiz', 'unit-test', 'mid-term', 'lab', 'viva', 'project', 'final'],
    required: true
  },
  
  testName: { 
    type: String, 
    required: true 
  },  // "Unit Test 1", "Assignment 3"
  
  marksObtained: { 
    type: Number, 
    required: true,
    min: 0
  },
  
  maxMarks: { 
    type: Number, 
    required: true,
    min: 1
  },
  
  date: { 
    type: Date, 
    required: true 
  },
  
  remarks: String,
  
  enteredBy: { 
    type: mongoose.Schema.Types.ObjectId, 
    ref: 'User',
    required: true
  },
  
  createdAt: { type: Date, default: Date.now },
  updatedAt: { type: Date, default: Date.now }
});

// Prevent duplicate marks entries
marksSchema.index(
  { studentId: 1, subjectId: 1, testType: 1, testName: 1 }, 
  { unique: true }
);

// Validation: marks cannot exceed max
marksSchema.pre('save', function(next) {
  if (this.marksObtained > this.maxMarks) {
    return next(new Error('Marks obtained cannot exceed maximum marks'));
  }
  next();
});
```

---

## 6ï¸âƒ£ Angular Teacher Dashboard Structure

### Component Hierarchy

```
src/app/
â”œâ”€â”€ core/
â”‚   â”œâ”€â”€ guards/
â”‚   â”‚   â”œâ”€â”€ auth.guard.ts
â”‚   â”‚   â””â”€â”€ teacher.guard.ts
â”‚   â”œâ”€â”€ interceptors/
â”‚   â”‚   â””â”€â”€ auth.interceptor.ts
â”‚   â”œâ”€â”€ services/
â”‚   â”‚   â”œâ”€â”€ auth.service.ts
â”‚   â”‚   â”œâ”€â”€ subject.service.ts
â”‚   â”‚   â”œâ”€â”€ attendance.service.ts
â”‚   â”‚   â”œâ”€â”€ marks.service.ts
â”‚   â”‚   â”œâ”€â”€ deadline.service.ts
â”‚   â”‚   â””â”€â”€ analytics.service.ts
â”‚   â””â”€â”€ models/
â”‚       â”œâ”€â”€ user.model.ts
â”‚       â”œâ”€â”€ subject.model.ts
â”‚       â”œâ”€â”€ attendance.model.ts
â”‚       â””â”€â”€ marks.model.ts
â”‚
â”œâ”€â”€ features/
â”‚   â”œâ”€â”€ auth/
â”‚   â”‚   â”œâ”€â”€ login/
â”‚   â”‚   â”‚   â””â”€â”€ login.component.ts
â”‚   â”‚   â””â”€â”€ auth.module.ts
â”‚   â”‚
â”‚   â”œâ”€â”€ teacher/
â”‚   â”‚   â”œâ”€â”€ teacher-routing.module.ts
â”‚   â”‚   â”œâ”€â”€ teacher.module.ts
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ dashboard/
â”‚   â”‚   â”‚   â””â”€â”€ teacher-dashboard.component.ts      # Main dashboard
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ subjects/
â”‚   â”‚   â”‚   â”œâ”€â”€ subject-list/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ subject-list.component.ts       # View all subjects
â”‚   â”‚   â”‚   â”œâ”€â”€ subject-form/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ subject-form.component.ts       # Create/Edit subject
â”‚   â”‚   â”‚   â””â”€â”€ subject-detail/
â”‚   â”‚   â”‚       â””â”€â”€ subject-detail.component.ts     # Subject details
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ attendance/
â”‚   â”‚   â”‚   â”œâ”€â”€ mark-attendance/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ mark-attendance.component.ts    # Mark attendance form
â”‚   â”‚   â”‚   â”œâ”€â”€ attendance-history/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ attendance-history.component.ts # View past attendance
â”‚   â”‚   â”‚   â””â”€â”€ attendance-report/
â”‚   â”‚   â”‚       â””â”€â”€ attendance-report.component.ts  # Class attendance report
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ marks/
â”‚   â”‚   â”‚   â”œâ”€â”€ enter-marks/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ enter-marks.component.ts        # Marks entry form
â”‚   â”‚   â”‚   â”œâ”€â”€ marks-list/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ marks-list.component.ts         # View marks
â”‚   â”‚   â”‚   â””â”€â”€ marks-summary/
â”‚   â”‚   â”‚       â””â”€â”€ marks-summary.component.ts      # Class marks summary
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ deadlines/
â”‚   â”‚   â”‚   â”œâ”€â”€ deadline-form/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ deadline-form.component.ts      # Create/Edit deadline
â”‚   â”‚   â”‚   â””â”€â”€ deadline-list/
â”‚   â”‚   â”‚       â””â”€â”€ deadline-list.component.ts      # View deadlines
â”‚   â”‚   â”‚
â”‚   â”‚   â”œâ”€â”€ students/
â”‚   â”‚   â”‚   â”œâ”€â”€ student-list/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ student-list.component.ts       # View students in subject
â”‚   â”‚   â”‚   â”œâ”€â”€ student-detail/
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ student-detail.component.ts     # Individual student view
â”‚   â”‚   â”‚   â””â”€â”€ at-risk/
â”‚   â”‚   â”‚       â””â”€â”€ at-risk.component.ts            # At-risk students
â”‚   â”‚   â”‚
â”‚   â”‚   â””â”€â”€ analytics/
â”‚   â”‚       â””â”€â”€ class-analytics/
â”‚   â”‚           â””â”€â”€ class-analytics.component.ts    # Class-wide analytics
â”‚   â”‚
â”‚   â””â”€â”€ student/
â”‚       â””â”€â”€ ...  # Student module (separate)
â”‚
â””â”€â”€ shared/
    â”œâ”€â”€ components/
    â”‚   â”œâ”€â”€ navbar/
    â”‚   â”œâ”€â”€ sidebar/
    â”‚   â”œâ”€â”€ data-table/
    â”‚   â”œâ”€â”€ status-badge/
    â”‚   â””â”€â”€ loading-spinner/
    â””â”€â”€ shared.module.ts
```

### Teacher Routing

```typescript
// teacher-routing.module.ts
const routes: Routes = [
  {
    path: 'teacher',
    canActivate: [TeacherGuard],
    children: [
      { path: '', redirectTo: 'dashboard', pathMatch: 'full' },
      { path: 'dashboard', component: TeacherDashboardComponent },
      
      // Subjects
      { path: 'subjects', component: SubjectListComponent },
      { path: 'subjects/new', component: SubjectFormComponent },
      { path: 'subjects/:id', component: SubjectDetailComponent },
      { path: 'subjects/:id/edit', component: SubjectFormComponent },
      
      // Attendance
      { path: 'attendance/mark', component: MarkAttendanceComponent },
      { path: 'attendance/history/:subjectId', component: AttendanceHistoryComponent },
      { path: 'attendance/report/:subjectId', component: AttendanceReportComponent },
      
      // Marks
      { path: 'marks/enter', component: EnterMarksComponent },
      { path: 'marks/subject/:subjectId', component: MarksListComponent },
      { path: 'marks/summary/:subjectId', component: MarksSummaryComponent },
      
      // Deadlines
      { path: 'deadlines', component: DeadlineListComponent },
      { path: 'deadlines/new', component: DeadlineFormComponent },
      { path: 'deadlines/:id/edit', component: DeadlineFormComponent },
      
      // Students
      { path: 'students/:subjectId', component: StudentListComponent },
      { path: 'students/detail/:studentId', component: StudentDetailComponent },
      { path: 'at-risk', component: AtRiskComponent },
      
      // Analytics
      { path: 'analytics/:subjectId', component: ClassAnalyticsComponent }
    ]
  }
];
```

---

## 7ï¸âƒ£ Security: Student vs Teacher Dashboard Isolation

### Access Control Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      SECURITY LAYERS                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜

                         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                         â”‚  User Request   â”‚
                         â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 1: Angular Route Guards                                          â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â€¢ TeacherGuard: Blocks students from /teacher/* routes                 â”‚
â”‚  â€¢ StudentGuard: Blocks teachers from /student/* routes                 â”‚
â”‚  â€¢ Redirects unauthorized users to appropriate dashboard                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 2: Angular HTTP Interceptor                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â€¢ Attaches JWT token to all API requests                               â”‚
â”‚  â€¢ Redirects to login on 401 errors                                     â”‚
â”‚  â€¢ Handles token refresh (if implemented)                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 3: Express Auth Middleware                                       â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â€¢ Validates JWT token                                                  â”‚
â”‚  â€¢ Extracts user from token payload                                     â”‚
â”‚  â€¢ Rejects invalid/expired tokens with 401                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 4: Role Middleware                                               â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â€¢ Checks user.role against required role for route                     â”‚
â”‚  â€¢ Teacher routes require role === 'teacher'                            â”‚
â”‚  â€¢ Returns 403 Forbidden if role mismatch                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                  â”‚
                                  â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  LAYER 5: Resource Ownership Check                                      â”‚
â”‚  â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
â”‚  â€¢ Students can only access their OWN data                              â”‚
â”‚  â€¢ Teachers can only access subjects THEY created                       â”‚
â”‚  â€¢ Example: GET /attendance/student/:id checks if id === req.user.id    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Implementation Examples

#### Backend: Protected Routes

```javascript
// routes/teacher.routes.js

const router = express.Router();

// Apply auth + role middleware to ALL teacher routes
router.use(authMiddleware);
router.use(roleMiddleware('teacher'));

// These routes are now protected
router.post('/subjects', subjectController.create);
router.post('/attendance/mark', attendanceController.mark);
router.post('/marks', marksController.enter);
router.post('/deadlines', deadlineController.create);

module.exports = router;
```

#### Backend: Student Data Access Control

```javascript
// controllers/attendance.controller.js

async getStudentAttendance(req, res) {
  const { studentId } = req.params;
  
  // SECURITY CHECK: Students can only view their own data
  if (req.user.role === 'student' && req.user.userId !== studentId) {
    return res.status(403).json({ 
      error: 'Access denied: Cannot view other student data' 
    });
  }
  
  // Teachers can view any student in their subjects
  if (req.user.role === 'teacher') {
    const isEnrolled = await this.checkStudentInTeacherSubjects(
      studentId, 
      req.user.userId
    );
    if (!isEnrolled) {
      return res.status(403).json({ 
        error: 'Access denied: Student not in your subjects' 
      });
    }
  }
  
  // Proceed with data fetch
  const attendance = await AttendanceService.getStudentAttendance(studentId);
  res.json(attendance);
}
```

#### Angular: Hidden UI Elements

```typescript
// teacher-only buttons hidden from student view
@Component({
  template: `
    <!-- Visible to everyone -->
    <div class="attendance-display">
      <span>Attendance: {{ percentage }}%</span>
    </div>
    
    <!-- Only visible to teachers -->
    <div *ngIf="authService.isTeacher()" class="teacher-actions">
      <button (click)="editAttendance()">Edit Attendance</button>
      <button (click)="deleteRecord()">Delete Record</button>
    </div>
  `
})
export class AttendanceCardComponent {
  constructor(public authService: AuthService) {}
}
```

### API Segregation Summary

| Endpoint Pattern | Accessible By | Why |
|-----------------|---------------|-----|
| `POST /attendance/mark` | Teacher only | Only teachers mark attendance |
| `GET /attendance/student/:id` | Student (own) + Teacher | Students see own, teachers see enrolled students |
| `POST /marks` | Teacher only | Only teachers enter marks |
| `GET /marks/student/:id` | Student (own) + Teacher | Same as attendance |
| `POST /subjects` | Teacher only | Only teachers create subjects |
| `GET /subjects` | All authenticated | Everyone can see subjects list |
| `POST /deadlines` | Teacher only | Only teachers create deadlines |
| `GET /deadlines` | All authenticated | Everyone can see deadlines |

---

## Summary

| Aspect | Implementation |
|--------|---------------|
| **Auth** | JWT tokens with role in payload |
| **Authorization** | 4-layer security (Guards â†’ Interceptor â†’ Auth MW â†’ Role MW) |
| **Attendance Logic** | Real-time % calculation, eligibility determination |
| **Data Isolation** | Students see own data only, teachers see enrolled students |
| **API Design** | RESTful, role-protected, resource-scoped |
| **Angular Structure** | Feature modules with lazy loading |

> **Next Step**: Implement the actual code for backend routes, MongoDB models, and Angular components.
